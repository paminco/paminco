
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>Pigou’s Example &#8212; paminco 0.1 documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/paminco.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/user_guide.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/api.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/contentui.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Sioux Falls - User Equilibrium" href="sioux_fixed_ue.html" />
    <link rel="prev" title="Braess Paradox" href="braess_paradox.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo1.svg" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../getting_started.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../api/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../theory/index.html">
  Theoretical Background
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/paminco/paminco" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Applications
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Traffic Networks
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="background.html">
       Background
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="braess_paradox.html">
       Braess Paradox
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Pigou's Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sioux_fixed_ue.html">
       SiouxFalls - User Eqiulibrium
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sioux_par_poa.html">
       SiouxFalls - Parametric Price of Anarchy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="barcelona_poa.html">
       Barcelona - Price of Anarchy
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../gas/index.html">
     Gaslib
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../gas/stub.html">
       Stub
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../network_setup/index.html">
   How to Set Up a Network
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_graph_setup.html">
     How to set up directed and undirected graphs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_set_cost.html">
     How to equip a network with cost functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_set_demand.html">
     How to specify the demand function for a network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_read_from_xml.html">
     How to readin network data from XML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_shortest_path.html">
     How to calculate shortest path
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_plot_network.html">
     How to plot a network
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#system-optimum-user-equilibrium-and-price-of-anarchy">
   1. System optimum, user equilibrium and price of anarchy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#system-optimum-so">
     1.1 System optimum (SO)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#user-equilibrium-ue">
     1.2 User equilibrium (UE)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#price-of-anarchy-poa">
     1.3 Price of Anarchy (PoA)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-ue-and-so-with-paminco">
   2. Calculate UE and SO with paminco
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equilibrium-flows">
     2.1 Equilibrium flows
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-price-of-anarchy">
     2.2 The Price of Anarchy
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pigou-s-example">
<h1>Pigou’s Example<a class="headerlink" href="#pigou-s-example" title="Permalink to this headline">¶</a></h1>
<p>Consider the following network, also called <a class="reference external" href="https://www.networkpages.nl/equilibrium-congestion-models-pigous-example/#:~:text=That%20is%2C%20when%20we%20have,100th%20of%20the%20traffic.">Pigou’s example</a>, where the two vertices <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">t</span></code> are connected with two parallel edges.</p>
<figure class="align-default" id="pigou">
<a class="reference internal image-reference" href="../../../_images/pigou.png"><img alt="../../../_images/pigou.png" src="../../../_images/pigou.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Pigou’s example.</span><a class="headerlink" href="#pigou" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The upper edge has a constant link travel time <span class="math notranslate nohighlight">\(l_1(x_1) = 1\)</span> invariant of the upper link flow <span class="math notranslate nohighlight">\(x_1\)</span>, whereas the travel time on the lower edge varies by edge flow: <span class="math notranslate nohighlight">\(l_2(x_2) = x_2\)</span>.
In total, we send 1 unit from s to t, i.e., <span class="math notranslate nohighlight">\(x_1\)</span> is the fraction of driver that use the upper edge and <span class="math notranslate nohighlight">\(x_2\)</span> that use the lower edge, and <span class="math notranslate nohighlight">\(x_1 + x_2 = 1\)</span>.</p>
<section id="system-optimum-user-equilibrium-and-price-of-anarchy">
<h2>1. System optimum, user equilibrium and price of anarchy<a class="headerlink" href="#system-optimum-user-equilibrium-and-price-of-anarchy" title="Permalink to this headline">¶</a></h2>
<section id="system-optimum-so">
<h3>1.1 System optimum (SO)<a class="headerlink" href="#system-optimum-so" title="Permalink to this headline">¶</a></h3>
<p>A centralized planner – e.g., the government – may strive to minimize the average travel time for all participants: <span class="math notranslate nohighlight">\(\underset{\mathbf{x}}{\mathrm{argmin} \text{ }} \sum_{e \in E} x_{e} \cdot l_{e}(x_e)\)</span>.</p>
<p>The so called system optimum (SO) is easily computed by:</p>
<div class="math notranslate nohighlight">
\[
    \begin{equation*}
        \underset{x_1, x_2}{\mathrm{argmin} \text{ }} x_1 \cdot l_1(x_1) + x_2 \cdot l_2(x_2).
    \end{equation*}
\]</div>
<p>By substituting <span class="math notranslate nohighlight">\(x_2 = 1 - x_1\)</span> this equals:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{equation*}
        \underset{x_1}{\mathrm{argmin \text{ }}} x_1 \cdot 1 + (1-x_1) \cdot (1-x_1) = \\
        \underset{x_1}{\mathrm{argmin \text{ }}} x_1 + (1-x_1)^2,
    \end{equation*}
\end{split}\]</div>
<p>where the system optimal flow is: <span class="math notranslate nohighlight">\(x_1 = x_2 = 1/2\)</span>. The total travel time in the system optimum is thus <span class="math notranslate nohighlight">\(C_\text{SO} = 1/2 \cdot 1 + 1/2 \cdot 1/2 = 1/2 + 1/4 = 3/4\)</span>.</p>
</section>
<section id="user-equilibrium-ue">
<h3>1.2 User equilibrium (UE)<a class="headerlink" href="#user-equilibrium-ue" title="Permalink to this headline">¶</a></h3>
<p>In the user equilibrium – with the assumption that all participants have perfect information – all routes from s to t will take the same amount of time, i.e.,:</p>
<div class="math notranslate nohighlight">
\[
    \begin{equation}
        l_1(x_1) = l_2(x_2) \Leftrightarrow 1 = x_2.
    \end{equation}
\]</div>
<p>All users are using the lower arc to go from <span class="math notranslate nohighlight">\(s\)</span> to <span class="math notranslate nohighlight">\(t\)</span>: <span class="math notranslate nohighlight">\(x_1=0, x_2=1\)</span>. This leads to a total system travel time of <span class="math notranslate nohighlight">\(C_\text{UE} = 0 \cdot 1 + 1 \cdot 1 = 0 + 1 = 1\)</span>.</p>
</section>
<section id="price-of-anarchy-poa">
<h3>1.3 Price of Anarchy (PoA)<a class="headerlink" href="#price-of-anarchy-poa" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Price_of_anarchy">Price of Annarchy</a> (PoA) measures the inefficency of the network utilization due to selfish behaviour of the participants.
It is calculated as the ratio of the total (or equivalently average) travel time for all particpants in the user equilbrium to that of the system optimum:</p>
<div class="math notranslate nohighlight">
\[
    \begin{equation*}
        \text{PoA} = \frac{C(\text{UE})}{C(\text{SO})} = \frac{1}{3/4} = 4/3.
    \end{equation*}
\]</div>
</section>
</section>
<section id="calculate-ue-and-so-with-paminco">
<h2>2. Calculate UE and SO with paminco<a class="headerlink" href="#calculate-ue-and-so-with-paminco" title="Permalink to this headline">¶</a></h2>
<p>Our implementation cannot deal with parallel edges and we thus have to transform the network slightly:</p>
<figure class="align-default" id="pigou-artificial-vert">
<a class="reference internal image-reference" href="../../../_images/pigou_artificial_vert.png"><img alt="../../../_images/pigou_artificial_vert.png" src="../../../_images/pigou_artificial_vert.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Adding artificial vertices <span class="math notranslate nohighlight">\(V_1\)</span> and <span class="math notranslate nohighlight">\(V_2\)</span> to bypass parallel edges.</span><a class="headerlink" href="#pigou-artificial-vert" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>As the network has polynomial edge costs, we can simply pass in the polynomial coefficients to the network constructor:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">REL_DIR</span>  <span class="o">=</span> <span class="s2">&quot;../../../../..&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">REL_DIR</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">paminco</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paminco</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># We add artifical vertices v and w to bypass parallel edges problem</span>
<span class="n">edge_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">],</span>
                      <span class="p">])</span>
<span class="c1"># l_e = 1 = 1 + 0*x -&gt; coeff = (1, 0)</span>
<span class="c1"># l_e = x = 0 + 1*x -&gt; coeff = (0, 1)</span>
<span class="n">cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                 <span class="p">])</span>
<span class="n">demand_data</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">lbl2id</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">pigou</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">edge_data</span><span class="o">=</span><span class="n">edge_data</span><span class="p">,</span> 
                       <span class="n">cost_data</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span> 
                       <span class="n">demand_data</span><span class="o">=</span><span class="n">demand_data</span><span class="p">,</span>
                       <span class="n">kw_edge</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;map_labels_to_indices&quot;</span><span class="p">:</span> <span class="n">lbl2id</span><span class="p">}</span>
                       <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We find minimum cost flows that coincide with user equilibrium and system optimum if we transform the edge cost by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \text{User equilibrium:} \quad F_e &amp;= \int_0^{x_e} l_e(s) ds \\ 
        \text{System optimum:} \quad F_e &amp;= x_e \cdot l_e.
    \end{align}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># Calculate user equilibrium -&gt; F_e = integral_0^(x_e) l_e(s)ds</span>
<span class="n">pigou_ue</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">pigou</span><span class="p">)</span>
<span class="n">pigou_ue</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fw_ue</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">NetworkFW</span><span class="p">(</span><span class="n">pigou_ue</span><span class="p">)</span>
<span class="n">fw_ue</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># Calculate system optimum -&gt; F_e = x_e * l_e</span>
<span class="n">pigou_so</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">pigou</span><span class="p">)</span> 
<span class="n">pigou_so</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">times_x</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fw_so</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">NetworkFW</span><span class="p">(</span><span class="n">pigou_so</span><span class="p">)</span>
<span class="n">fw_so</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="equilibrium-flows">
<h3>2.1 Equilibrium flows<a class="headerlink" href="#equilibrium-flows" title="Permalink to this headline">¶</a></h3>
<p>We find flows on the (artificial) edges as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">flows_ue</span> <span class="o">=</span> <span class="n">fw_ue</span><span class="o">.</span><span class="n">flows</span><span class="p">[[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
<span class="n">flows_so</span> <span class="o">=</span> <span class="n">fw_so</span><span class="o">.</span><span class="n">flows</span><span class="p">[[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
<span class="n">flows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flows_ue</span><span class="p">,</span> <span class="n">flows_so</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">])</span>
<span class="n">flows</span><span class="p">[[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pigou</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">get_node_label</span><span class="p">(</span><span class="n">flows</span><span class="p">[[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">flows</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;flow user eq&quot;</span><span class="p">,</span> <span class="s2">&quot;flow sys opt&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flows</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  from to  flow user eq  flow sys opt
0    s  v           0.0           0.5
1    v  t           0.0           0.5
2    s  w           1.0           0.5
3    w  t           1.0           0.5
</pre></div>
</div>
</div>
</div>
<figure class="align-default" id="pigou-equilibria">
<a class="reference internal image-reference" href="../../../_images/pigou_equilibria.png"><img alt="../../../_images/pigou_equilibria.png" src="../../../_images/pigou_equilibria.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Flow in user equilibrium (left) and system optimum (right).</span><a class="headerlink" href="#pigou-equilibria" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="the-price-of-anarchy">
<h3>2.2 The Price of Anarchy<a class="headerlink" href="#the-price-of-anarchy" title="Permalink to this headline">¶</a></h3>
<p>The objective function to calculate the system optimum is the total system travel time (TSTT):</p>
<div class="math notranslate nohighlight">
\[
    \begin{equation*}
        \text{TSTT}(\mathbf{x}) = \sum_{e \in E} x_{e} \cdot l_{e}(x_e)
    \end{equation*}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">TTST</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pigou_so</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We find that the total system travel time for Barcelona is increased <code class="docutils literal notranslate"><span class="pre">33.33</span></code> percent if users behave selfishly. Note that we have to scale the cost by 1/2 due to the artificial edges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_ue</span> <span class="o">=</span> <span class="n">TTST</span><span class="p">(</span><span class="n">fw_ue</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">cost_so</span> <span class="o">=</span> <span class="n">TTST</span><span class="p">(</span><span class="n">fw_so</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">poa</span> <span class="o">=</span> <span class="n">cost_ue</span> <span class="o">/</span> <span class="n">cost_so</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cost user eqiulibrium: &quot;</span><span class="p">,</span> <span class="n">cost_ue</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cost system optimum:   &quot;</span><span class="p">,</span> <span class="n">cost_so</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Price of anarchy:      &quot;</span><span class="p">,</span> <span class="n">poa</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cost user eqiulibrium:  1.0
Cost system optimum:    0.75
Price of anarchy:       1.33
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Philipp Warode, Per Joachims.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>