
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>paminco.net.demand &#8212; paminco 0.1 documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/paminco.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/user_guide.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/api.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo1.svg" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../getting_started.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../api/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../theory/index.html">
  Theoretical Background
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/paminco/paminco" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for paminco.net.demand</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">et</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sps</span>

<span class="kn">from</span> <span class="nn">.shared</span> <span class="kn">import</span> <span class="n">Shared</span><span class="p">,</span> <span class="n">ID_UNMAPPED</span><span class="p">,</span> <span class="n">LBL_UNMAPPED</span>
<span class="kn">from</span> <span class="nn">paminco.utils.readin</span> <span class="kn">import</span> <span class="n">xml_find_root</span><span class="p">,</span> <span class="n">xml_add_element</span>
<span class="kn">from</span> <span class="nn">paminco.utils.typing</span> <span class="kn">import</span> <span class="n">is_int</span>
<span class="kn">from</span> <span class="nn">paminco.utils.misc</span> <span class="kn">import</span> <span class="n">Cache</span>
<span class="kn">from</span> <span class="nn">paminco</span> <span class="kn">import</span> <span class="n">_doc</span>


<span class="n">TAG_COMMODITIES</span> <span class="o">=</span> <span class="s2">&quot;commodities&quot;</span>
<span class="n">DTYPE_INT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
<span class="n">DTYPE_FLOAT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>


<div class="viewcode-block" id="Commodity"><a class="viewcode-back" href="../../../api/net/demand/commodity.html#paminco.net.demand.Commodity">[docs]</a><span class="k">class</span> <span class="nc">Commodity</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract class of a commodity.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; @ &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Commodity.from_data"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.Commodity.from_data.html#paminco.net.demand.Commodity.from_data">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct commodity from ``data``.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : tuple or dict</span>
<span class="sd">        </span>
<span class="sd">            ``(source, target, rate)``: a CommoditySingleSourceSink is constructed.</span>
<span class="sd">            </span>
<span class="sd">            ``dict``: a CommodityMultiSourceSink is constructed.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CommoditySingleSourceSink or CommodityMultiSourceSink</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        CommoditySingleSourceSink</span>
<span class="sd">        CommodityMultiSourceSink</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Commodity</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">CommoditySingleSourceSink</span><span class="o">.</span><span class="n">from_tuple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CommodityMultiSourceSink</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data for commodity must be tuple of len 3 or dict.&quot;</span><span class="p">)</span></div>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_scaled_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">map_node_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">map_node_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">source_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sink_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sink_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span></div>


<div class="viewcode-block" id="CommoditySingleSourceSink"><a class="viewcode-back" href="../../../api/net/demand/commodity-singlest.html#paminco.net.demand.CommoditySingleSourceSink">[docs]</a><span class="k">class</span> <span class="nc">CommoditySingleSourceSink</span><span class="p">(</span><span class="n">Commodity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commodity with exactly one source and one sink.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source : str or int</span>
<span class="sd">        Label or index of source.</span>
<span class="sd">    sink : str or int</span>
<span class="sd">        Label or index of sink.</span>
<span class="sd">    rate : float</span>
<span class="sd">        Rate of flow from source to sink.</span>
<span class="sd">    is_label : bool, default=True</span>
<span class="sd">        If True, source and sink are expected to be str, else as int.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    has_valid_indices</span>
<span class="sd">    has_valid_labels</span>
<span class="sd">    source_lbl</span>
<span class="sd">    source_id</span>
<span class="sd">    sink_lbl</span>
<span class="sd">    sink_id</span>
<span class="sd">    rate</span>
<span class="sd">    total_rate</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">source</span><span class="p">,</span>
            <span class="n">sink</span><span class="p">,</span>
            <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">is_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;source and sink must be str if is_label==True.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_lbl</span> <span class="o">=</span> <span class="n">source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sink_lbl</span> <span class="o">=</span> <span class="n">sink</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span> <span class="o">=</span> <span class="n">ID_UNMAPPED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sink_id</span> <span class="o">=</span> <span class="n">ID_UNMAPPED</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">is_int</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;source and sink must be int if is_label==False.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_lbl</span> <span class="o">=</span> <span class="n">LBL_UNMAPPED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sink_lbl</span> <span class="o">=</span> <span class="n">LBL_UNMAPPED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span> <span class="o">=</span> <span class="n">source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sink_id</span> <span class="o">=</span> <span class="n">sink</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="n">rate</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CommoditySingleSourceSink</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Comparison object must be of type &#39;CommoditySingleSourceSink&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_source_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;_sink_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;_source_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;_sink_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;_rate&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_indices</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_labels</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_lbl</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="si">}</span><span class="s2">) </span><span class="se">\u2192</span><span class="s2"> &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_lbl</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="si">}</span><span class="s2">) | </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_labels</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_lbl</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u2192</span><span class="s2"> &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_lbl</span><span class="si">}</span><span class="s2">&#39; | </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\u2192</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Neither ids not labels have been mapped.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CommoditySingleSourceSink.get_scaled_copy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.get_scaled_copy.html#paminco.net.demand.CommoditySingleSourceSink.get_scaled_copy">[docs]</a>    <span class="k">def</span> <span class="nf">get_scaled_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommoditySingleSourceSink</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a copy of commodity with rate scaled by ``scale_factor``.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale_factor : float, default=1</span>
<span class="sd">            Scale rate from source to sink by scale_factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CommoditySingleSourceSink</span>
<span class="sd">            Commodity with rate scaled by ``scale_factor``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">CommoditySingleSourceSink</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_source_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;_source_id&quot;</span><span class="p">,</span> <span class="s2">&quot;_sink_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;_sink_id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;_rate&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpy</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_rate</span> <span class="o">*=</span> <span class="n">scale_factor</span>
        <span class="k">return</span> <span class="n">cpy</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.get_sparse_elements"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.get_sparse_elements.html#paminco.net.demand.CommoditySingleSourceSink.get_sparse_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_sparse_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract commodity data for sparse demand matrix.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        col_number : int, default=0</span>
<span class="sd">            Column indices of the matrix entries.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            ``[source_id, sink_id]``: Row indices of the matrix entries .</span>
<span class="sd">        list</span>
<span class="sd">            ``[col_number, col_number]``: Column indices.</span>
<span class="sd">        list</span>
<span class="sd">            ``[-rate, rate]``: Data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_number</span><span class="p">,</span> <span class="n">col_number</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.map_node_labels"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.map_node_labels.html#paminco.net.demand.CommoditySingleSourceSink.map_node_labels">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Map labels -&gt; ids by d.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_lbl</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sink_id</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_lbl</span><span class="p">]</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.map_node_ids"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.map_node_ids.html#paminco.net.demand.CommoditySingleSourceSink.map_node_ids">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Map ids -&gt; labels by d.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_lbl</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sink_lbl</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.node_in_comm"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.node_in_comm.html#paminco.net.demand.CommoditySingleSourceSink.node_in_comm">[docs]</a>    <span class="k">def</span> <span class="nf">node_in_comm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">is_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check whether commodity is made up by node in ``node``.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : int, str or array_like</span>
<span class="sd">            Nodes to check for.</span>
<span class="sd">        is_label : bool, default=True</span>
<span class="sd">            Whether nodes in ``node`` are labels.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether commodity is made up with ``node``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine search array</span>
        <span class="k">if</span> <span class="n">is_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">search_arr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_lbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_lbl</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search_arr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="p">]</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">search_arr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.to_tuple"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.to_tuple.html#paminco.net.demand.CommoditySingleSourceSink.to_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">to_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get Commodity data as tuple.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        as_label : bool, default=True</span>
<span class="sd">            If True, return (source_label, sink_label, rate), else</span>
<span class="sd">            (source_id, sink_id, rate).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            War commodity data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">as_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_lbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_lbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.from_tuple"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.from_tuple.html#paminco.net.demand.CommoditySingleSourceSink.from_tuple">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tuple</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommoditySingleSourceSink</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct from tuple (source, sink, rate).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : tuple</span>
<span class="sd">            ``(source, sink, rate)``: Raw commodity data.</span>
<span class="sd">        kwargs : keyword arguments, optional</span>
<span class="sd">            Further keyword arguments passed to CommoditySingleSourceSink</span>
<span class="sd">            constructor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CommoditySingleSourceSink</span>
<span class="sd">            Commodity object created from ``t``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommoditySingleSourceSink.from_labels_and_id"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommoditySingleSourceSink.from_labels_and_id.html#paminco.net.demand.CommoditySingleSourceSink.from_labels_and_id">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_labels_and_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommoditySingleSourceSink</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct from fully specified data (labels and ids).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : tuple</span>
<span class="sd">            ``(node_labels, ndoes_ids, rate)`` where ``node_labels``</span>
<span class="sd">            is a tuple of str (source_label, sink_label), ``node_ids``</span>
<span class="sd">            a tuple of int (source_id, sink_id) and ``rate`` a float.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CommoditySingleSourceSink</span>
<span class="sd">            Commodity object created from ``data``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_source_lbl</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_sink_lbl</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_source_id</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_sink_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">c</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_valid_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether node labels have been mapped to node indices.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_id</span> <span class="o">==</span> <span class="n">ID_UNMAPPED</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span> <span class="o">==</span> <span class="n">ID_UNMAPPED</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_valid_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether node indices have been mapped to node labels.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_lbl</span> <span class="o">==</span> <span class="n">LBL_UNMAPPED</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sink_lbl</span> <span class="o">==</span> <span class="n">LBL_UNMAPPED</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;str: label of source node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_lbl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;int: index of source node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;str: label of sink node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sink_lbl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;int: index of sink node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sink_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;float: rate of flow from source to sink.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;float: rate of flow from source to sink.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span></div>


<div class="viewcode-block" id="CommodityMultiSourceSink"><a class="viewcode-back" href="../../../api/net/demand/commodity-multist.html#paminco.net.demand.CommodityMultiSourceSink">[docs]</a><span class="k">class</span> <span class="nc">CommodityMultiSourceSink</span><span class="p">(</span><span class="n">Commodity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commodity with multiple sources and/or multiple sinks.</span>
<span class="sd">    </span>
<span class="sd">    A CommodityMultiSourceSink can be comprised of any number of sources (N_in) and</span>
<span class="sd">    any number of sinks (N_out). The total number of nodes that make up a</span>
<span class="sd">    CommodityMultiSourceSink is thus N_tot = N_in + N_out.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : dict</span>
<span class="sd">        Keys are node labels or ids, values are rate (in/outflow).</span>
<span class="sd">    is_label : bool, default=True,</span>
<span class="sd">        Whether keys in ``data`` are labels.</span>
<span class="sd">    check_validity : bool, default=False</span>
<span class="sd">        Check whether sum of values in ``data`` equals 0.</span>
<span class="sd">    dtype_float : type, default=numpy.float_</span>
<span class="sd">        Datatype to save rate values.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
            <span class="n">is_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">check_validity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float_</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># get nodes and rates from dict</span>
        <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype_float</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">check_validity</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Total in/outflow: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;&quot;does not equal 0.&quot;</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">is_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># retrieve nodes as labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">ID_UNMAPPED</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># retrieve nodes as indices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">LBL_UNMAPPED</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CommodityMultiSourceSink</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Comparison object must be of type &#39;CommodityMultiSourceSink&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_node_labels&#39;</span><span class="p">,</span> <span class="s1">&#39;_node_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span>
        
        <span class="k">def</span> <span class="nf">nl</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_indices</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_labels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nl</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">) : </span><span class="si">{</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_labels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nl</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; : </span><span class="si">{</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_indices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nl</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}{</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Neither ids not labels have been mapped.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="CommodityMultiSourceSink.decompose"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.decompose.html#paminco.net.demand.CommodityMultiSourceSink.decompose">[docs]</a>    <span class="k">def</span> <span class="nf">decompose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decompose CommodityMultiSourceSink into several single commodities.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_iter : int, optional</span>
<span class="sd">            Number of iterations for decomposition</span>
<span class="sd">        as_label : bool, default=True</span>
<span class="sd">            If True return tuples with node labels, else with node ids.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Single commodities as tuples (source, sink, rate).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_iter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Init search and results</span>
        <span class="n">search_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
        <span class="n">st_pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_matched</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="c1"># get most negative source</span>
            <span class="n">idx_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">search_array</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">search_array</span><span class="p">[</span><span class="n">idx_s</span><span class="p">]</span>
            
            <span class="c1"># get unmatched sink</span>
            <span class="n">idx_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">search_array</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">search_array</span><span class="p">[</span><span class="n">idx_t</span><span class="p">]</span>
            
            <span class="c1"># matched value</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
            
            <span class="c1"># consolidate sink/source</span>
            <span class="n">search_array</span><span class="p">[</span><span class="n">idx_s</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mv</span>
            <span class="n">search_array</span><span class="p">[</span><span class="n">idx_t</span><span class="p">]</span> <span class="o">-=</span> <span class="n">mv</span>
            <span class="n">total_matched</span> <span class="o">+=</span> <span class="n">mv</span>
            
            <span class="c1"># store found pair</span>
            <span class="k">if</span> <span class="n">as_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">[</span><span class="n">idx_s</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">[</span><span class="n">idx_t</span><span class="p">],</span>
                    <span class="n">mv</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">[</span><span class="n">idx_s</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">[</span><span class="n">idx_t</span><span class="p">],</span>
                    <span class="n">mv</span>
                <span class="p">)</span>
            <span class="n">st_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
            
            <span class="c1"># check if consolidation successful</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">total_matched</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_rate</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">search_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
                <span class="k">return</span> <span class="n">st_pairs</span>
        
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find s-t-pair decomposition.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommodityMultiSourceSink.node_in_comm"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.node_in_comm.html#paminco.net.demand.CommodityMultiSourceSink.node_in_comm">[docs]</a>    <span class="k">def</span> <span class="nf">node_in_comm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">is_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># determine search array</span>
        <span class="k">if</span> <span class="n">is_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">search_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">search_arr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="n">node_in_comm</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">CommoditySingleSourceSink</span><span class="o">.</span><span class="n">node_in_comm</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="CommodityMultiSourceSink.to_dict"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.to_dict.html#paminco.net.demand.CommodityMultiSourceSink.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get commodity as dict.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        labels : bool, default=True</span>
<span class="sd">            If True, returned dict has node labels as keys, else node indices.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Commodity as dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_labels</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_indices</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Commodity has neither valid indices nor valid labels&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Commodity has neither valid indices nor valid labels&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CommodityMultiSourceSink.get_scaled_copy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.get_scaled_copy.html#paminco.net.demand.CommodityMultiSourceSink.get_scaled_copy">[docs]</a>    <span class="k">def</span> <span class="nf">get_scaled_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get copy where every rate is scaled by `scale_factor`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CommodityMultiSourceSink</span>
<span class="sd">            Commodity with rate scaled by ``scale_factor``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">CommodityMultiSourceSink</span><span class="p">)</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">)</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">)</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span>
        <span class="k">return</span> <span class="n">cpy</span></div>

<div class="viewcode-block" id="CommodityMultiSourceSink.get_sparse_elements"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.get_sparse_elements.html#paminco.net.demand.CommodityMultiSourceSink.get_sparse_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_sparse_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract commodity data for sparse demand matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        col_number : int, default=0</span>
<span class="sd">            Column indices of the matrix entries.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Row indices of the matrix entries of len N_tot.</span>
<span class="sd">        list</span>
<span class="sd">            Column indices of the matrix entries of len N_tot. Equals</span>
<span class="sd">            [col_number, ..., col_number].</span>
<span class="sd">        list</span>
<span class="sd">            Matrix entries of len N_tot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">col_number</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommodityMultiSourceSink.map_node_labels"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.map_node_labels.html#paminco.net.demand.CommodityMultiSourceSink.map_node_labels">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>

    <span class="n">map_node_labels</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">CommoditySingleSourceSink</span><span class="o">.</span><span class="n">map_node_labels</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="CommodityMultiSourceSink.map_node_ids"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.map_node_ids.html#paminco.net.demand.CommodityMultiSourceSink.map_node_ids">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span></div>

    <span class="n">map_node_ids</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">CommoditySingleSourceSink</span><span class="o">.</span><span class="n">map_node_ids</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="CommodityMultiSourceSink.from_label_and_id"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.CommodityMultiSourceSink.from_label_and_id.html#paminco.net.demand.CommodityMultiSourceSink.from_label_and_id">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_label_and_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommodityMultiSourceSink</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct from fully specified data (labels and ids).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : tuple of ndarray</span>
<span class="sd">            ``(labels, ids, rate)`` where every element is ndarray of</span>
<span class="sd">            shape (N_tot, ).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CommodityMultiSourceSink</span>
<span class="sd">            Commodity constructed from data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make empty object and fill with data</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cm</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N_tot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Total number of nodes in commodity: sinks + sources.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N_in</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of sources.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_tot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_out</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N_out</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of sinks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_sink</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_sink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_tot, ) of bool: whether node is sink.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_valid_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;bool: whether nodes have proper indices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ID_UNMAPPED</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_valid_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;bool: whether nodes have proper labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">LBL_UNMAPPED</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_labels</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_single</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;bool: whether commodity has single source and single sink.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">node_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_tot, ) of int: node indices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">node_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_tot, ) of str: node labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_in, ) of str: source labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">is_sink</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_in, ) of int: source indices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">is_sink</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_out, ) of str: sink labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">is_sink</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_out, ) of int: sink indices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">is_sink</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (N_tot, ) of float: in/outflow per node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;float: total flow on commodity.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">is_sink</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>


<div class="viewcode-block" id="_DV"><a class="viewcode-back" href="../../../api/net/demand/dv.html#paminco.net.demand._DV">[docs]</a><span class="k">class</span> <span class="nc">_DV</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class of a demand vector.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span> <span class="o">=</span> <span class="n">shared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_int</span> <span class="o">=</span> <span class="n">dtype_int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_float</span> <span class="o">=</span> <span class="n">dtype_float</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get demand as sparse matrix of shape (n, k).</span>
<span class="sd">        </span>
<span class="sd">        Every column represents the in/outflow for the network nodes</span>
<span class="sd">        for one commodity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="_DV.get_source_sink_rate"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand._DV.get_source_sink_rate.html#paminco.net.demand._DV.get_source_sink_rate">[docs]</a>    <span class="k">def</span> <span class="nf">get_source_sink_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_by</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a source-sink-rate decomposition of this demand vector.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale_by : float, default=1</span>
<span class="sd">            The demand vector is scaled by this factor before determining</span>
<span class="sd">            the s-t-r-decompositions</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        decomposition : tuple</span>
<span class="sd">            A tuple ``(s, t, r)`` containing sources ``s`` sinks ``t`` and</span>
<span class="sd">            associated demand rates ``r`` that induce this demand vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_single</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TODO.&quot;</span><span class="p">)</span>

        <span class="c1"># Retrieve rates</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="p">()</span>
        <span class="n">rates</span> <span class="o">=</span> <span class="n">scale_by</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Collect (cached) sources</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;source_indices&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;source_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;source_indices&quot;</span><span class="p">]</span>
        
        <span class="c1"># Collect (cached) sinks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;sink_indices&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">sinks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sink_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sinks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sink_indices&quot;</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="n">rates</span></div>

<div class="viewcode-block" id="_DV.add_to_etree"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand._DV.add_to_etree.html#paminco.net.demand._DV.add_to_etree">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_etree</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">root</span><span class="p">:</span> <span class="n">et</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add demand data to xml.etree.ElementTree.Element.</span>
<span class="sd">        </span>
<span class="sd">        Data will be added based on self.value(param=1). Note that only</span>
<span class="sd">        LinearDemandFunctions can be properly saved to xml.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root : xml.etree.ElementTree.Element</span>
<span class="sd">            Element to which &#39;commodities&#39; will be appended to.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Attribute name of &#39;commodities&#39; element. If None, no attribute</span>
<span class="sd">            will be set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commodities</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;commodities&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">commodities</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        
        <span class="n">spmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">spmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">spmat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">lbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">get_node_label</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">data</span>
            <span class="n">com_node</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodities</span><span class="p">,</span> <span class="s1">&#39;commodity&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Commodity with single source and single sink</span>
                <span class="n">com_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbls</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">com_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbls</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">com_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Commodity with multiple sources and/or multipls sinks</span>
                <span class="n">com_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lbls</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">elem_lbl</span><span class="p">,</span> <span class="n">elem_val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">com_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">elem_val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">b_node</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">com_node</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
                        <span class="n">b_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem_lbl</span>
                        <span class="n">b_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">elem_val</span><span class="p">)</span></div>

<div class="viewcode-block" id="_DV.from_npz"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand._DV.from_npz.html#paminco.net.demand._DV.from_npz">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_npz</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DemandVector</span> <span class="o">|</span> <span class="n">DemandVectorSP</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;node_labels&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DemandVectorSP</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    <span class="n">from_npz</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">from_npz_shared</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">k</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of commodities in demand vector.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">n</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_n&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">&quot;Number of nodes has not been set: Neither shared object nor &quot;</span>
            <span class="s2">&quot;number of nodes specified.&quot;</span>
        <span class="p">)</span>
    
    <span class="nd">@n</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shared object for network objects.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        paminco.net.shared.Shared</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span>
    
    <span class="nd">@shared</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_int</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">dtype_int</span>
        <span class="k">return</span> <span class="n">DTYPE_INT</span>
    
    <span class="nd">@dtype_int</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dtype_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_int</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_float</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_float</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">dtype_float</span>
        <span class="k">return</span> <span class="n">DTYPE_FLOAT</span>
    
    <span class="nd">@dtype_float</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dtype_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_float</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">to_single_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">map_node_label_to_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">map_node_id_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">scaled_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">make_save_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">save_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">all_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">source_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sink_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sink_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span></div>


<div class="viewcode-block" id="DemandVector"><a class="viewcode-back" href="../../../api/net/demand/dv-std.html#paminco.net.demand.DemandVector">[docs]</a><span class="k">class</span> <span class="nc">DemandVector</span><span class="p">(</span><span class="n">_DV</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that builds on a number of commodities (k).</span>
<span class="sd">    </span>
<span class="sd">    A DemandVector object can be instantiated in several ways:</span>
<span class="sd">        DemandVector(dv)</span>
<span class="sd">            where ``dv`` is a DemandVector.</span>
<span class="sd">        DemandVector(M)</span>
<span class="sd">            where ``M`` is matrix (ndarray or spmatrix) with node</span>
<span class="sd">            indices as rows and commodities as columns.</span>
<span class="sd">        DemandVector(it)</span>
<span class="sd">            where ``it`` an iterable with elements that are tuples or</span>
<span class="sd">            dicts.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shared : Shared</span>
<span class="sd">        Shared object for all network objects.</span>
<span class="sd">    data : DemandVector, ndarray, spmatrix, or iterable</span>
<span class="sd">        (Processed) commodity data.</span>
<span class="sd">    copy : bool, default=True</span>
<span class="sd">        Whether to copy data in ``data``.</span>
<span class="sd">    is_label : bool, default=True</span>
<span class="sd">        Whether commodity nodes are given as labels or ids in data if</span>
<span class="sd">        data is iterable.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    k</span>
<span class="sd">    shared</span>
<span class="sd">    all_single</span>
<span class="sd">    commodities</span>
<span class="sd">    source_lbl</span>
<span class="sd">    sink_lbl</span>
<span class="sd">    source_id</span>
<span class="sd">    sink_id</span>
<span class="sd">    rate</span>
<span class="sd">    total_rate</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    Commodity</span>
<span class="sd">    CommoditySingleSourceSink</span>
<span class="sd">    CommodityMultiSourceSink</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DemandVector</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">_comm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_comm</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">vals</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CommodityMultiSourceSink</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">is_label</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="p">[</span><span class="n">Commodity</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">is_label</span><span class="o">=</span><span class="n">is_label</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> \
            <span class="s2">&quot;DemandVectors must have same length.&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_comm</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">c1</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">)</span>

<div class="viewcode-block" id="DemandVector.reset_cache"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.reset_cache.html#paminco.net.demand.DemandVector.reset_cache">[docs]</a>    <span class="k">def</span> <span class="nf">reset_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hard</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">hard</span><span class="o">=</span><span class="n">hard</span><span class="p">)</span></div>
    
    <span class="n">reset_cache</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">reset_cache</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVector.delete_nodes"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.delete_nodes.html#paminco.net.demand.DemandVector.delete_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Delete all commodities that are made up by ``nodes``.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : int or array_like</span>
<span class="sd">            Indices of nodes to remove.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of removed commodities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">len_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">node_in_comm</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">is_label</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_cache</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">len_before</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandVector.map_node_label_to_id"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.map_node_label_to_id.html#paminco.net.demand.DemandVector.map_node_label_to_id">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_label_to_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Map labels -&gt; ids for all commodities.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">map_node_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">node2id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node with label </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> not in network nodes.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set_invalid</span><span class="p">(</span><span class="s2">&quot;source_id&quot;</span><span class="p">,</span> <span class="s2">&quot;sink_id&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandVector.map_node_id_to_label"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.map_node_id_to_label.html#paminco.net.demand.DemandVector.map_node_id_to_label">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_id_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Map ids -&gt; labels for all commodities.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">node2id</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">map_node_ids</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node with id </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> not in network nodes.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set_invalid</span><span class="p">(</span><span class="s2">&quot;source_lbl&quot;</span><span class="p">,</span> <span class="s2">&quot;sink_lbl&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandVector.scaled_copy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.scaled_copy.html#paminco.net.demand.DemandVector.scaled_copy">[docs]</a>    <span class="k">def</span> <span class="nf">scaled_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a copy where rate of every commodity is scaled by ``f``.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        f : float, default=1</span>
<span class="sd">            Scale factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DemandVector</span>
<span class="sd">            Copy of demand vector with scaled commodites.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">DemandVector</span><span class="p">)</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_comm</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">get_scaled_copy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">]</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cpy</span></div>

<div class="viewcode-block" id="DemandVector.to_single_pairs"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.to_single_pairs.html#paminco.net.demand.DemandVector.to_single_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">to_single_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decompose all CommodityMultiSourceSink.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        as_label : bool, default=True</span>
<span class="sd">            If True decomposed commodites are set up by labels, else</span>
<span class="sd">            by id.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DemandVectorSP</span>
<span class="sd">            Demand vector with single commodities only.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        CommodityMultiSourceSink.decompose</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">CommodityMultiSourceSink</span><span class="p">):</span>
                <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">decompose</span><span class="p">(</span><span class="n">as_label</span><span class="o">=</span><span class="n">as_label</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">to_tuple</span><span class="p">(</span><span class="n">as_label</span><span class="o">=</span><span class="n">as_label</span><span class="p">))</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">DemandVectorSP</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span> <span class="n">is_label</span><span class="o">=</span><span class="n">as_label</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">as_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">map_node_label_to_id</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">dv</span></div>

<div class="viewcode-block" id="DemandVector.sparse"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.sparse.html#paminco.net.demand.DemandVector.sparse">[docs]</a>    <span class="k">def</span> <span class="nf">sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get demand as sparse matrix.</span>

<span class="sd">        Total in/outflow per node (row) per commodity (column), e.g.:</span>
<span class="sd">            Data::</span>
<span class="sd">            </span>
<span class="sd">                (0, 2, 100)            [single commodity]</span>
<span class="sd">                {1: 33, 2: 33, 3: -66} [multi commodity]</span>
<span class="sd">            </span>
<span class="sd">            Resulting matrix::</span>
<span class="sd">            </span>
<span class="sd">                [[-100,    0],</span>
<span class="sd">                 [   0,   33],</span>
<span class="sd">                 [ 100,   33],</span>
<span class="sd">                 [   0,  -66]]</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dtype: dtype, optional</span>
<span class="sd">            Datatype of returned sparse matrix.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scipy.sparse.csc_matrix</span>
<span class="sd">            Demand as sparse matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_float</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;sparse&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">):</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">get_sparse_elements</span><span class="p">(</span><span class="n">col_number</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">+=</span> <span class="n">r</span>
                <span class="n">cols</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">d</span>
            
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span>
                                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(</span><span class="n">sparse</span><span class="p">),</span> <span class="n">sparse</span><span class="p">)</span>
        
        <span class="c1"># recast datatype if necessary for return</span>
        <span class="k">return</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandVector.make_save_dict"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.make_save_dict.html#paminco.net.demand.DemandVector.make_save_dict">[docs]</a>    <span class="k">def</span> <span class="nf">make_save_dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">save_dict</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">save_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;demand_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">save_dict</span><span class="p">:</span>
            <span class="n">save_dict</span><span class="p">[</span><span class="s2">&quot;demand_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        
        <span class="n">idx_single</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idx_multi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rates</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># collect all single commodites and remember indices</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">CommoditySingleSourceSink</span><span class="p">):</span>
                <span class="n">idx_single</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_source_lbl&quot;</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_sink_lbl&quot;</span><span class="p">)])</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_source_id&quot;</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_sink_id&quot;</span><span class="p">)])</span>
                <span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_rate&quot;</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">CommodityMultiSourceSink</span><span class="p">):</span>
                <span class="n">idx_multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cm_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_node_ids&quot;</span><span class="p">)</span>
                <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cm_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_node_labels&quot;</span><span class="p">)</span>
                <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cm_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;_rate&quot;</span><span class="p">)</span>
        
        <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cs_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cs_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cs_rates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>
        <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;idx_single&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx_single</span><span class="p">)</span>
        <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;idx_multi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx_multi</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">save_dict</span></div>

    <span class="n">make_save_dict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">make_save_dict</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVector.save_to_numpy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.save_to_numpy.html#paminco.net.demand.DemandVector.save_to_numpy">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_save_dict</span><span class="p">()</span>
        <span class="n">save_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">save_dict</span><span class="p">)</span></div>
    
    <span class="n">save_to_numpy</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVector.from_xml"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.from_xml.html#paminco.net.demand.DemandVector.from_xml">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span> <span class="k">pass</span></div>
    <span class="c1"># TODO-PJ linmk to func</span>

<div class="viewcode-block" id="DemandVector.from_npz"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVector.from_npz.html#paminco.net.demand.DemandVector.from_npz">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_npz</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DemandVector</span><span class="p">:</span>
        <span class="c1"># load data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="n">cs_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cs_labels&quot;</span><span class="p">]</span>
        <span class="n">cs_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cs_ids&quot;</span><span class="p">]</span>
        <span class="n">cs_rates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cs_rates&quot;</span><span class="p">]</span>
        <span class="n">idx_single</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;idx_single&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">idx_multi</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;idx_multi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx_single</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">idx_single</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx_single</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx_multi</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">idx_multi</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx_multi</span><span class="p">]</span>
        
        <span class="n">comm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># load single commodites</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cs_labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cs_labels</span><span class="p">,</span> <span class="n">cs_ids</span><span class="p">,</span> <span class="n">cs_rates</span><span class="o">.</span><span class="n">ravel</span><span class="p">())):</span>
                <span class="n">comm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CommoditySingleSourceSink</span><span class="o">.</span><span class="n">from_labels_and_id</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        
        <span class="c1"># load multi commodities</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_multi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx_m</span> <span class="ow">in</span> <span class="n">idx_multi</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;cm_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx_m</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="s2">&quot;label&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="s2">&quot;rate&quot;</span><span class="p">]]</span>
                <span class="n">comm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CommodityMultiSourceSink</span><span class="o">.</span><span class="n">from_label_and_id</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        
        <span class="c1"># reindex commodities</span>
        <span class="n">idx_full</span> <span class="o">=</span> <span class="n">idx_single</span> <span class="o">+</span> <span class="n">idx_multi</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">idx_full</span><span class="p">,</span> <span class="n">comm</span><span class="p">))]</span>
        
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    <span class="n">from_npz</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">from_npz_shared</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_single</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether is comprised only of commodities with single sink / source.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;sparse&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getnnz</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getnnz</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">commodities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;List [len k] of commdodities: CommoditySingleSourceSink or CommodityMultiSourceSink.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;List [len k] of str or ndarray: source labels per commodity.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;source_lbl&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;source_lbl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">source_lbl</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;source_lbl&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;List [len k] of str or ndarray: sink labels per commodity.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;sink_lbl&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sink_lbl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">sink_lbl</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sink_lbl&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;List [len k] of int or ndarray: source indices per commodity.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;source_id&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">source_id</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;List [len k] of int or ndarray: sink indices per commodity.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;sink_id&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sink_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">sink_id</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sink_id&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;List [len k] of float or ndarray: node in/outflow per commodity.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">rate</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;np.ndarray (k, ): total flow per commodity.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;total_rate&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;total_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">total_rate</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comm</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;total_rate&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="DemandVectorSP"><a class="viewcode-back" href="../../../api/net/demand/dv-sp.html#paminco.net.demand.DemandVectorSP">[docs]</a><span class="k">class</span> <span class="nc">DemandVectorSP</span><span class="p">(</span><span class="n">_DV</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that builds on a number of commodities `k`.</span>
<span class="sd">    </span>
<span class="sd">    A DemandVectorSP object can be instantiated in several ways:</span>
<span class="sd">        DemandVectorSP(dv)</span>
<span class="sd">            where ``dv`` is a DemandVectorSP.</span>
<span class="sd">        DemandVectorSP(arr)</span>
<span class="sd">            where ``arr`` is array_like. The resulting array from</span>
<span class="sd">            ``numpy.array(arr)`` is expected to look like::</span>

<span class="sd">                [source_1,   sink_1,   rate_1]</span>
<span class="sd">                            ...</span>
<span class="sd">                [source_k,   sink_k,   rate_k]</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : DemandVector or array_like</span>
<span class="sd">        Commodity data in processed or unprocessed form.</span>
<span class="sd">    shared : Shared, optional</span>
<span class="sd">        Shared object for all network objects.</span>
<span class="sd">    copy : bool, default=True</span>
<span class="sd">        Whether to copy data in ``data``.</span>
<span class="sd">    is_label : bool, default=True</span>
<span class="sd">        Whether commodity nodes are given as labels or ids in data.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    k</span>
<span class="sd">    shared</span>
<span class="sd">    all_single</span>
<span class="sd">    rate</span>
<span class="sd">    total_rate</span>
<span class="sd">    source_lbl</span>
<span class="sd">    sink_lbl</span>
<span class="sd">    source_id</span>
<span class="sd">    sink_id</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DemandVectorSP</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">_rates</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">ID_UNMAPPED</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">LBL_UNMAPPED</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># remove zero rate commodities</span>
        <span class="n">zc</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rates</span><span class="p">,</span> <span class="n">zc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rates</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_rates&quot;</span><span class="p">,</span> <span class="s2">&quot;_node_ids&quot;</span><span class="p">,</span> <span class="s2">&quot;_node_labels&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="DemandVectorSP.reset_cache"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.reset_cache.html#paminco.net.demand.DemandVectorSP.reset_cache">[docs]</a>    <span class="k">def</span> <span class="nf">reset_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hard</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">hard</span><span class="o">=</span><span class="n">hard</span><span class="p">)</span></div>
    
    <span class="n">reset_cache</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">reset_cache</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVectorSP.map_node_label_to_id"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.map_node_label_to_id.html#paminco.net.demand.DemandVectorSP.map_node_label_to_id">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_label_to_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">,</span>
                                                      <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                              <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Node id &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not in network nodes.&quot;</span><span class="p">)</span></div>
    
    <span class="n">map_node_label_to_id</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">map_node_label_to_id</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVectorSP.map_node_id_to_label"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.map_node_id_to_label.html#paminco.net.demand.DemandVectorSP.map_node_id_to_label">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_id_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">get_node_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">,</span>
                                                            <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                 <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Node id &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not in network nodes.&quot;</span><span class="p">)</span></div>

    <span class="n">map_node_id_to_label</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">delete_nodes</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVectorSP.scaled_copy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.scaled_copy.html#paminco.net.demand.DemandVectorSP.scaled_copy">[docs]</a>    <span class="k">def</span> <span class="nf">scaled_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a copy where every commodity is scaled by `f`.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        f : float, default=1</span>
<span class="sd">            Scale factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DemandVectorSP</span>
<span class="sd">            Copy of DemandVectorSP with scaled commodites.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpy</span> <span class="o">=</span> <span class="n">DemandVectorSP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cpy</span><span class="o">.</span><span class="n">_rates</span> <span class="o">*=</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">cpy</span></div>

<div class="viewcode-block" id="DemandVectorSP.to_single_pairs"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.to_single_pairs.html#paminco.net.demand.DemandVectorSP.to_single_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">to_single_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DemandVectorSP</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns self.</span>
<span class="sd">        </span>
<span class="sd">        Used for consistency with DemandVector.to_single_pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DemandVectorSP.delete_nodes"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.delete_nodes.html#paminco.net.demand.DemandVectorSP.delete_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">len_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># identify commodities where source or sink equals nodes</span>
        <span class="n">idx_source</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">idx_sink</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sink_id</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">all_idx</span> <span class="o">=</span> <span class="n">idx_source</span> <span class="o">|</span> <span class="n">idx_sink</span>
        
        <span class="c1"># delete indices in data arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rates</span><span class="p">,</span> <span class="n">all_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">,</span> <span class="n">all_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">,</span> <span class="n">all_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_cache</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">len_before</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
    
    <span class="n">delete_nodes</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">delete_nodes</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVectorSP.sparse"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.sparse.html#paminco.net.demand.DemandVectorSP.sparse">[docs]</a>    <span class="k">def</span> <span class="nf">sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get demand as sparse matrix.</span>
<span class="sd">        </span>
<span class="sd">        Total in/outflow per node (row) per commodity (column), e.g.,:</span>
<span class="sd">            Data::</span>
<span class="sd">            </span>
<span class="sd">                (0, 2, 100)</span>
<span class="sd">                (3, 1, 66)</span>
<span class="sd">            </span>
<span class="sd">            Resulting matrix::</span>
<span class="sd">            </span>
<span class="sd">                [[-100,    0],</span>
<span class="sd">                 [   0,   66],</span>
<span class="sd">                 [ 100,    0],</span>
<span class="sd">                 [   0,  -66]]</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dtype: dtype, optional</span>
<span class="sd">            Datatype of returned sparse matrix.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scipy.sparse.csc_matrix</span>
<span class="sd">            Demand as sparse matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_float</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;sparse&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">sparse</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span>
                                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(</span><span class="n">sparse</span><span class="p">),</span> <span class="n">sparse</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(</span><span class="n">sparse</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># recast datatype if necessary for return</span>
        <span class="k">return</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandVectorSP.make_save_dict"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.make_save_dict.html#paminco.net.demand.DemandVectorSP.make_save_dict">[docs]</a>    <span class="k">def</span> <span class="nf">make_save_dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">save_dict</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">save_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;demand_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">save_dict</span><span class="p">:</span>
            <span class="n">save_dict</span><span class="p">[</span><span class="s2">&quot;demand_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        
        <span class="n">save_att</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;node_labels&quot;</span><span class="p">:</span> <span class="s2">&quot;_node_labels&quot;</span><span class="p">,</span>
            <span class="s2">&quot;node_ids&quot;</span><span class="p">:</span> <span class="s2">&quot;_node_ids&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rates&quot;</span><span class="p">:</span> <span class="s2">&quot;_rates&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">save_att</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">save_dict</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">save_dict</span></div>
    
    <span class="n">make_save_dict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">make_save_dict</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVectorSP.save_to_numpy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.save_to_numpy.html#paminco.net.demand.DemandVectorSP.save_to_numpy">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_save_dict</span><span class="p">()</span>
        <span class="n">save_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">save_dict</span><span class="p">)</span></div>
    
    <span class="n">save_to_numpy</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandVectorSP.from_xml"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.from_xml.html#paminco.net.demand.DemandVectorSP.from_xml">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span> <span class="k">pass</span></div>
    <span class="c1"># TODO-PJ linmk to func</span>

<div class="viewcode-block" id="DemandVectorSP.from_npz"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandVectorSP.from_npz.html#paminco.net.demand.DemandVectorSP.from_npz">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_npz</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DemandVectorSP</span><span class="p">:</span>
        <span class="c1"># load np data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># make empty edge object and fill with data</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;rates&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_node_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;node_labels&quot;</span><span class="p">]</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_node_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;node_ids&quot;</span><span class="p">]</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_rates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;rates&quot;</span><span class="p">]</span>
        <span class="n">dv</span><span class="o">.</span><span class="n">_s</span> <span class="o">=</span> <span class="n">shared</span>
        <span class="n">dv</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">dv</span></div>
    
    <span class="n">from_npz</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">from_npz_shared</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_single</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="n">all_single</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">all_single</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (k, ) of flow: rates.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rates</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (k, ) of str: source labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (k, ) of str: sink labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (k, ) of int: source indices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ndarray (k, ) of int: sink indices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_ids</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span>

    <span class="n">total_rate</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">total_rate</span><span class="o">.</span><span class="vm">__doc__</span></div>


<span class="k">def</span> <span class="nf">read_comm_from_xml</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read commodity data from XML.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : str, xml.etree.ElementTree.ElementTree, or xml.etree.ElementTree.Element</span>
<span class="sd">        XML file, tree or root itself.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    com_data : list, optional</span>
<span class="sd">        Commodity data, one commodity per element in list. A tuple</span>
<span class="sd">        ``(source, target, rate) `` corresponds to a commodity with a</span>
<span class="sd">        one source and one target. Otherwise a dict with the out/inflow</span>
<span class="sd">        is appended, e.g., {node1: -100, node2: 50, node3: 50}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">et</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">xml_find_root</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">TAG_COMMODITIES</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">TAG_COMMODITIES</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">_comm_from_xml_node</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_comm_from_xml_node</span><span class="p">(</span><span class="n">xml_commodity_node</span><span class="p">:</span> <span class="n">et</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">com_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xml_commodity_node</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">attrib</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]))</span>
            <span class="n">com_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">b_nodes</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">b_nodes</span><span class="p">:</span>
                <span class="n">c_info</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
            <span class="n">com_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_info</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">com_data</span>


<span class="k">def</span> <span class="nf">demand_vector</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype_float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">single_pairs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DemandVector</span> <span class="o">|</span> <span class="n">DemandVectorSP</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Setup demand vector based on ``data``.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : DemandVector, DemandVectorSP, spmatrix, ndarray, or iterable</span>
<span class="sd">    </span>
<span class="sd">        ``DemandVector or DemandVectorSP``: (a copy) of data will be</span>
<span class="sd">        returned.</span>
<span class="sd">        </span>
<span class="sd">        ``spmatrix or ndarray``: a DemandVector will be inferred.</span>
<span class="sd">        </span>
<span class="sd">        ``iterable and single_pairs == False`` : DemandVector.</span>
<span class="sd">        </span>
<span class="sd">        ``iterable and single_pairs == True`` : DemandVectorSP.</span>
<span class="sd">    </span>
<span class="sd">    shared : Shared</span>
<span class="sd">        Shared object for all network objects.</span>
<span class="sd">    single_pairs : bool, default=False,</span>
<span class="sd">        If True, infer DemandVectorSP, else DemandVector.</span>
<span class="sd">    kwargs : keyword arguments, optional</span>
<span class="sd">        Further keyword arguments passed to constructor.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DemandVector or DemandVectorSP</span>
<span class="sd">        Demand vector.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    paminco.net.demand.DemandVector</span>
<span class="sd">    paminco.net.demand.DemandVectorSP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse from xml</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">read_comm_from_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DemandVector</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DemandVector</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DemandVectorSP</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DemandVectorSP</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sps</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DemandVector</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">single_pairs</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DemandVectorSP</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
                <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
                <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DemandVector</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
                <span class="n">dtype_int</span><span class="o">=</span><span class="n">dtype_int</span><span class="p">,</span>
                <span class="n">dtype_float</span><span class="o">=</span><span class="n">dtype_float</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>


<div class="viewcode-block" id="DemandFunction"><a class="viewcode-back" href="../../../api/net/demand/func.html#paminco.net.demand.DemandFunction">[docs]</a><span class="k">class</span> <span class="nc">DemandFunction</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract class representing a demand function.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shared : Shared, optional</span>
<span class="sd">        Shared network object used for label &lt;-&gt; id mappings.</span>
<span class="sd">        </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    cache : Cache</span>
<span class="sd">        A cache.</span>
<span class="sd">    shared</span>
<span class="sd">    all_single_pairs</span>
<span class="sd">    shared</span>
<span class="sd">    demand_vectors</span>
<span class="sd">    is_single_commodity</span>
<span class="sd">    is_multi_commodity</span>
<span class="sd">    value_at_1</span>
<span class="sd">    unique_sources</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype_float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span> <span class="o">=</span> <span class="n">shared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_int</span> <span class="o">=</span> <span class="n">dtype_int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype_float</span> <span class="o">=</span> <span class="n">dtype_float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> \
            <span class="s2">&quot;DemandFunctions must have same number of commodities.&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dv1</span><span class="p">,</span> <span class="n">dv2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">demand_vectors</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dv1</span> <span class="o">!=</span> <span class="n">dv2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of commodities modelled by the demand function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>

<div class="viewcode-block" id="DemandFunction.reset_cache"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.reset_cache.html#paminco.net.demand.DemandFunction.reset_cache">[docs]</a>    <span class="k">def</span> <span class="nf">reset_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hard</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span></div>
    
    <span class="n">reset_cache</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">reset_cache</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandFunction.inflow"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.inflow.html#paminco.net.demand.DemandFunction.inflow">[docs]</a>    <span class="k">def</span> <span class="nf">inflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the total inflow of all commodities for demand(param).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : float</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Total inflow of all commodities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></div>

<div class="viewcode-block" id="DemandFunction.ddx_inflow"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.ddx_inflow.html#paminco.net.demand.DemandFunction.ddx_inflow">[docs]</a>    <span class="k">def</span> <span class="nf">ddx_inflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the total inflow of all commodities for demand&#39;(param).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : float</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Total inflow of all commodities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddx</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></div>

<div class="viewcode-block" id="DemandFunction.max_inflow"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.max_inflow.html#paminco.net.demand.DemandFunction.max_inflow">[docs]</a>    <span class="k">def</span> <span class="nf">max_inflow</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">max_param</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">min_param</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get maxmimum inflow for every commodity.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_param : float</span>
<span class="sd">        </span>
<span class="sd">        min_param : float, default=0</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Ndarray of shape (k, ): max inflow for every commodity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">min_param</span><span class="p">)</span>
        <span class="n">b_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">max_param</span><span class="p">)</span>
        <span class="n">inflow_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_min</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b_min</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">inflow_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_max</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">inflow_min</span><span class="p">,</span> <span class="n">inflow_max</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandFunction.delete_nodes"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.delete_nodes.html#paminco.net.demand.DemandFunction.delete_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">len_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">delete_nodes</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">len_before</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
    
    <span class="n">delete_nodes</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">delete_nodes</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandFunction.map_node_label_to_id"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.map_node_label_to_id.html#paminco.net.demand.DemandFunction.map_node_label_to_id">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_label_to_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">map_node_label_to_id</span><span class="p">()</span></div>
    
    <span class="n">map_node_label_to_id</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">map_node_label_to_id</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandFunction.map_node_id_to_label"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.map_node_id_to_label.html#paminco.net.demand.DemandFunction.map_node_id_to_label">[docs]</a>    <span class="k">def</span> <span class="nf">map_node_id_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">map_node_id_to_label</span><span class="p">()</span></div>
    
    <span class="n">map_node_id_to_label</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">DemandVector</span><span class="o">.</span><span class="n">map_node_id_to_label</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandFunction.to_single_pairs"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.to_single_pairs.html#paminco.net.demand.DemandFunction.to_single_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">to_single_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Decompose all commodities in demand vectors.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_vectors</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">to_single_pairs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="DemandFunction.add_to_etree"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.add_to_etree.html#paminco.net.demand.DemandFunction.add_to_etree">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_etree</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">root</span><span class="p">:</span> <span class="n">et</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add demand data to xml.etree.ElementTree.Element.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root : xml.etree.ElementTree.Element</span>
<span class="sd">            Element to which &#39;commodities&#39; will be appended to.</span>
<span class="sd">        overwrite : bool, default=True</span>
<span class="sd">            If True, existing &#39;commodities&#39; Element in root will be</span>
<span class="sd">            deleted. If False, edge data will be appended to the</span>
<span class="sd">            existing data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">TAG_COMMODITIES</span><span class="p">):</span>
                <span class="n">root</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                
        <span class="c1"># Write type of demand func to metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">xml_add_element</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">demand_func</span> <span class="o">=</span> <span class="n">xml_add_element</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;demand_func&quot;</span><span class="p">)</span>
        <span class="n">demand_func</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                
        <span class="c1"># Write all demand vectors of demand function</span>
        <span class="k">for</span> <span class="n">dv_name</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">add_to_etree</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">dv_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandFunction.from_xml"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.from_xml.html#paminco.net.demand.DemandFunction.from_xml">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearDemandFunction</span> <span class="o">|</span> <span class="n">AffineDemandFunction</span><span class="p">:</span>
        <span class="c1"># Get root of XML</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">xml_find_root</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># Determine which type of demand function to readin</span>
        <span class="n">demand_func</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;metadata/demand_func&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">demand_func</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">demand_func</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;LinearDemandFunction&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">LinearDemandFunction</span><span class="o">.</span><span class="n">from_xml</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">demand_func</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;AffineDemandFunction&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AffineDemandFunction</span><span class="o">.</span><span class="n">from_xml</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid demand_func in XML: </span><span class="si">{</span><span class="n">demand_func</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DemandFunction.make_save_dict"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.make_save_dict.html#paminco.net.demand.DemandFunction.make_save_dict">[docs]</a>    <span class="k">def</span> <span class="nf">make_save_dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">save_dict</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">save_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_dict</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">save_dict</span><span class="p">[</span><span class="s2">&quot;demand_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">save_dict</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">make_save_dict</span><span class="p">(</span>
                <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                <span class="n">save_dict</span><span class="o">=</span><span class="n">save_dict</span><span class="p">,</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">save_dict</span></div>

    <span class="n">make_save_dict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">make_save_dict</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandFunction.save_to_numpy"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.save_to_numpy.html#paminco.net.demand.DemandFunction.save_to_numpy">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_save_dict</span><span class="p">()</span>
        <span class="n">save_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">save_dict</span><span class="p">)</span></div>
    
    <span class="n">save_to_numpy</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DemandFunction.from_npz"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.DemandFunction.from_npz.html#paminco.net.demand.DemandFunction.from_npz">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_npz</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearDemandFunction</span> <span class="o">|</span> <span class="n">AffineDemandFunction</span><span class="p">:</span>
        <span class="c1"># load np data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;demand_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;demand_type&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;LinearDemandFunction&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">LinearDemandFunction</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;demand_type&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;AffineDemandFunction&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AffineDemandFunction</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid demand type: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;demand_type&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>

    <span class="n">from_npz</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">from_npz_shared</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_dv0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_single_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;bool: whether all commodities have single source/sink.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">((</span><span class="bp">self</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">getnnz</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">n</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dv0</span><span class="o">.</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dv0</span><span class="o">.</span><span class="n">n</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">&quot;Number of nodes has not been set: Neither shared object nor &quot;</span>
            <span class="s2">&quot;number of nodes specified.&quot;</span>
        <span class="p">)</span>
    
    <span class="nd">@n</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shared object for network objects.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        paminco.net.shared.Shared</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dv0</span><span class="o">.</span><span class="n">shared</span>
    
    <span class="nd">@shared</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">Shared</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="n">s</span>
    
    <span class="n">shared</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_DV</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="vm">__doc__</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dv0</span><span class="o">.</span><span class="n">dtype_int</span>
    
    <span class="nd">@dtype_int</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dtype_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">dtype_int</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dv0</span><span class="o">.</span><span class="n">dtype_float</span>
    
    <span class="nd">@dtype_float</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dtype_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">dtype_float</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">demand_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get names and values for all vectors making up demand func.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_vectors</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_single_commodity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether demand function consists of single commodity only.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_multi_commodity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether demand function consists of more than one commodity.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value_at_1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get value of demand function h(1).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;value_at_1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;value_at_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;value_at_1&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unique_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get all unique sources.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="s2">&quot;unique_sources&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">u_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_vectors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">u_sources</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">u_sources</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">dv</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getnnz</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;unique_sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_sources</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;unique_sources&quot;</span><span class="p">]</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">ddx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_source_sink_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span></div>


<div class="viewcode-block" id="LinearDemandFunction"><a class="viewcode-back" href="../../../api/net/demand/func-lin.html#paminco.net.demand.LinearDemandFunction">[docs]</a><span class="k">class</span> <span class="nc">LinearDemandFunction</span><span class="p">(</span><span class="n">DemandFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Linear demand function.</span>
<span class="sd">    </span>
<span class="sd">    Modelling the function::</span>
<span class="sd">    </span>
<span class="sd">        demand(param) = param * b.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b : DemandVector, DemandVectorSP, spmatrix or iterable</span>
<span class="sd">        Demand direction, scales linearly with param.</span>
<span class="sd">    shared : Shared, optional</span>
<span class="sd">        Shared object for all network objects.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    b : DemandVector or DemandVectorSP</span>
<span class="sd">        Demand direction, scales linearly with param.</span>
<span class="sd">    cache : Cache</span>
<span class="sd">        A cache.</span>
<span class="sd">    shared</span>
<span class="sd">    all_single_pairs</span>
<span class="sd">    shared</span>
<span class="sd">    demand_vectors</span>
<span class="sd">    is_single_commodity</span>
<span class="sd">    is_multi_commodity</span>
<span class="sd">    value_at_1</span>
<span class="sd">    unique_sources</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    demand_vector : Initialization of demand vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_demand_vectors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">b</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shared</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">demand_vector</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="LinearDemandFunction.max_inflow"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.LinearDemandFunction.max_inflow.html#paminco.net.demand.LinearDemandFunction.max_inflow">[docs]</a>    <span class="k">def</span> <span class="nf">max_inflow</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">max_param</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">min_param</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="s2">&quot;Inflow rate at ``max_param`` for all commodities.&quot;</span>
        <span class="k">return</span> <span class="n">max_param</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">total_rate</span></div>

<div class="viewcode-block" id="LinearDemandFunction.value"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.LinearDemandFunction.value.html#paminco.net.demand.LinearDemandFunction.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Value of demand function: demand(param).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param: float, default=1</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        csc_matrix</span>
<span class="sd">            demand&#39;(param).</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        DemandVector.sparse : details on the structure of the return</span>
<span class="sd">            matrix.</span>
<span class="sd">        DemandVectorSP.sparse : details on the structure of the return</span>
<span class="sd">            matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">param</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="LinearDemandFunction.ddx"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.LinearDemandFunction.ddx.html#paminco.net.demand.LinearDemandFunction.ddx">[docs]</a>    <span class="k">def</span> <span class="nf">ddx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Derivative of demand function: demand&#39;(param).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param: float, default=1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        csc_matrix</span>
<span class="sd">            demand&#39;(param).</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        DemandVector.sparse : details on the structure of the return</span>
<span class="sd">            matrix.</span>
<span class="sd">        DemandVectorSP.sparse : details on the structure of the return</span>
<span class="sd">            matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="LinearDemandFunction.get_source_sink_rate"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.LinearDemandFunction.get_source_sink_rate.html#paminco.net.demand.LinearDemandFunction.get_source_sink_rate">[docs]</a>    <span class="k">def</span> <span class="nf">get_source_sink_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get indices of source and sink, and rates for all commodities.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : float</span>
<span class="sd">            Scale rates by param.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        source_indices : ndarray</span>
<span class="sd">            Indices of sources, ndarray (k&#39;, ) of int, where k&#39; is the</span>
<span class="sd">            total amount of commodities making up this demand function.</span>
<span class="sd">            k&#39; is summed up over all demand vectors.</span>
<span class="sd">        sink_indices : ndarray</span>
<span class="sd">            Indices of sinks, ndarray (k&#39;, ) of int.</span>
<span class="sd">        rates : ndarray</span>
<span class="sd">            Rates, ndarray (k&#39;, ) of float.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">get_source_sink_rate</span><span class="p">(</span><span class="n">scale_by</span><span class="o">=</span><span class="n">param</span><span class="p">)</span></div>

<div class="viewcode-block" id="LinearDemandFunction.from_npz"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.LinearDemandFunction.from_npz.html#paminco.net.demand.LinearDemandFunction.from_npz">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_npz</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearDemandFunction</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_demand_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">_DV</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="LinearDemandFunction.from_xml"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.LinearDemandFunction.from_xml.html#paminco.net.demand.LinearDemandFunction.from_xml">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearDemandFunction</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">xml_find_root</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">_comm_from_xml_node</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">TAG_COMMODITIES</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="n">from_xml</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_doc</span><span class="o">.</span><span class="n">from_xml_shared</span><span class="o">.</span><span class="vm">__doc__</span></div>


<div class="viewcode-block" id="AffineDemandFunction"><a class="viewcode-back" href="../../../api/net/demand/func-aff.html#paminco.net.demand.AffineDemandFunction">[docs]</a><span class="k">class</span> <span class="nc">AffineDemandFunction</span><span class="p">(</span><span class="n">DemandFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An affine demand function.</span>
<span class="sd">    </span>
<span class="sd">    Modelling the function::</span>
<span class="sd">    </span>
<span class="sd">        demand(param) = b0 + param * b</span>
<span class="sd">    </span>
<span class="sd">    where b0 and b are demand vectors modelling an equal amount of</span>
<span class="sd">    commodities.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b0 : DemandVector, DemandVectorSP, spmatrix or iterable</span>
<span class="sd">        Base demand, unaffected by param.</span>
<span class="sd">    b : DemandVector, DemandVectorSP, spmatrix or iterable</span>
<span class="sd">        Demand direction, scales linearly with param.</span>
<span class="sd">    shared : Shared, optional</span>
<span class="sd">        Shared object for all network objects.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    b0 : DemandVector or DemandVectorSP</span>
<span class="sd">        Base demand, unaffected by param.</span>
<span class="sd">    b : DemandVector or DemandVectorSP</span>
<span class="sd">        Demand direction, scales linearly with param.</span>
<span class="sd">    cache : Cache</span>
<span class="sd">        A cache.</span>
<span class="sd">    shared</span>
<span class="sd">    all_single_pairs</span>
<span class="sd">    shared</span>
<span class="sd">    demand_vectors</span>
<span class="sd">    is_single_commodity</span>
<span class="sd">    is_multi_commodity</span>
<span class="sd">    value_at_1</span>
<span class="sd">    unique_sources</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    demand_vector : Initialization of demand vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_demand_vectors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b0&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">b0</span><span class="p">,</span>
            <span class="n">b</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shared</span><span class="p">)</span>
        
        <span class="c1"># init bection and base_demand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b0</span> <span class="o">=</span> <span class="n">demand_vector</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">demand_vector</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;b&#39; and &#39;b0&#39; must have the same number of commodities.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="AffineDemandFunction.value"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.AffineDemandFunction.value.html#paminco.net.demand.AffineDemandFunction.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b0</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">param</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    <span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">LinearDemandFunction</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="AffineDemandFunction.ddx"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.AffineDemandFunction.ddx.html#paminco.net.demand.AffineDemandFunction.ddx">[docs]</a>    <span class="k">def</span> <span class="nf">ddx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    <span class="n">ddx</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">LinearDemandFunction</span><span class="o">.</span><span class="n">ddx</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="AffineDemandFunction.get_source_sink_rate"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.AffineDemandFunction.get_source_sink_rate.html#paminco.net.demand.AffineDemandFunction.get_source_sink_rate">[docs]</a>    <span class="k">def</span> <span class="nf">get_source_sink_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">s0</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b0</span><span class="o">.</span><span class="n">get_source_sink_rate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">get_source_sink_rate</span><span class="p">(</span><span class="n">scale_by</span><span class="o">=</span><span class="n">param</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">s0</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">t0</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">r0</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span></div>
    
    <span class="n">get_source_sink_rate</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">LinearDemandFunction</span><span class="o">.</span><span class="n">get_source_sink_rate</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="AffineDemandFunction.from_npz"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.AffineDemandFunction.from_npz.html#paminco.net.demand.AffineDemandFunction.from_npz">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_npz</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearDemandFunction</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">_DV</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_demand_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">_DV</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_demand_vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AffineDemandFunction.from_xml"><a class="viewcode-back" href="../../../api/net/demand/generated/paminco.net.demand.AffineDemandFunction.from_xml.html#paminco.net.demand.AffineDemandFunction.from_xml">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AffineDemandFunction</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">xml_find_root</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">commodities</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">TAG_COMMODITIES</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">commodities</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">_comm_from_xml_node</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">comm</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;b0&quot;</span><span class="p">:</span>
                <span class="n">b0</span> <span class="o">=</span> <span class="n">_comm_from_xml_node</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div></div>
</pre></div>

              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Philipp Warode, Per Joachims.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>