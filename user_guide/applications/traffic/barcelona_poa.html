
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Price of Anarchy - Barcelona &#8212; paminco 0.1 documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/contentui.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/paminco.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/user_guide.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/api.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/contentui.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Gaslib" href="../gas/index.html" />
    <link rel="prev" title="SiouxFalls - (Parametric) Price of Anarchy" href="sioux_par_poa.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo1.svg" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../getting_started.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../api/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../theory/index.html">
  Theoretical Background
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/paminco/paminco" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Applications
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Traffic Networks
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="background.html">
       Background
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="braess_paradox.html">
       Braess Paradox
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="pigou_example.html">
       Pigou's Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sioux_fixed_ue.html">
       SiouxFalls - User Eqiulibrium
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sioux_par_poa.html">
       SiouxFalls - Parametric Price of Anarchy
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Barcelona - Price of Anarchy
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../gas/index.html">
     Gaslib
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../gas/stub.html">
       Stub
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../network_setup/index.html">
   How to Set Up a Network
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_graph_setup.html">
     How to set up directed and undirected graphs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_set_cost.html">
     How to equip a network with cost functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_set_demand.html">
     How to specify the demand function for a network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_read_from_xml.html">
     How to readin network data from XML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_shortest_path.html">
     How to calculate shortest path
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../network_setup/howto_plot_network.html">
     How to plot a network
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports-and-network-readin">
   1. Imports and network readin
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-network-cost">
   2. Setting up network cost
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-ue-and-so-flow">
   3. Find UE and SO flow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#price-of-anarchy">
   4. Price of Anarchy
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">REL_DIR</span>  <span class="o">=</span> <span class="s2">&quot;../../../../../&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">REL_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="price-of-anarchy-barcelona">
<h1>Price of Anarchy - Barcelona<a class="headerlink" href="#price-of-anarchy-barcelona" title="Permalink to this headline">¶</a></h1>
<section id="imports-and-network-readin">
<h2>1. Imports and network readin<a class="headerlink" href="#imports-and-network-readin" title="Permalink to this headline">¶</a></h2>
<p>First, we import the <em>paminco</em> and some other packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">paminco</span>
</pre></div>
</div>
</div>
</div>
<p>We load the Barcelona network from our converted .xml file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barcelona</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">Network</span><span class="o">.</span><span class="n">from_xml</span><span class="p">(</span><span class="n">REL_DIR</span> <span class="o">+</span> <span class="s2">&quot;data/traffic/Barcelona.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
FileNotFoundError                         Traceback (most recent call last)
/tmp/ipykernel_2112/2419181191.py in &lt;module&gt;
----&gt; 1 barcelona = paminco.net.Network.from_xml(REL_DIR + &quot;data/traffic/Barcelona.xml&quot;)

~/work/paminco/paminco/docs/source/user_guide/applications/traffic/../../../../../paminco/net/network.py in from_xml(cls, file, return_dict, **kwargs)
   1584             ``from_xml`` method of NetworkCost class
   1585         &quot;&quot;&quot;
-&gt; 1586         edge_data = Edges.from_xml(file, return_data=True)
   1587         node_data = Nodes.from_xml(file, return_data=True)
   1588         demand_data = file

~/work/paminco/paminco/docs/source/user_guide/applications/traffic/../../../../../paminco/net/shared.py in from_xml(cls, data, return_data, **kwargs)
    423             **kwargs
    424             ):
--&gt; 425         data = xml_find_root(data)
    426         edges = data.find(&quot;edges&quot;)
    427         if edges is None:

~/work/paminco/paminco/docs/source/user_guide/applications/traffic/../../../../../paminco/utils/readin.py in xml_find_root(data, root_tag)
    157     if isinstance(data, str):
    158         if data.endswith(&quot;.xml&quot;):
--&gt; 159             data = et.parse(data)
    160         else:
    161             data = et.fromstring(data)

/opt/hostedtoolcache/Python/3.8.12/x64/lib/python3.8/xml/etree/ElementTree.py in parse(source, parser)
   1200     &quot;&quot;&quot;
   1201     tree = ElementTree()
-&gt; 1202     tree.parse(source, parser)
   1203     return tree
   1204 

/opt/hostedtoolcache/Python/3.8.12/x64/lib/python3.8/xml/etree/ElementTree.py in parse(self, source, parser)
    582         close_source = False
    583         if not hasattr(source, &quot;read&quot;):
--&gt; 584             source = open(source, &quot;rb&quot;)
    585             close_source = True
    586         try:

FileNotFoundError: [Errno 2] No such file or directory: &#39;../../../../../data/traffic/Barcelona.xml&#39;
</pre></div>
</div>
</div>
</div>
<p>Note that we assume that the power factor <span class="math notranslate nohighlight">\(p_e\)</span> for the link travel time <span class="math notranslate nohighlight">\(l_e(x_e) = \text{fft}_e \cdot \left( 1 + B_e \cdot \left(\frac{x}{\text{cap}_e}\right) ^ {p_e} \right)\)</span> is an integer. This is not the case for the Barcelona network, where we find power factors such  <code class="docutils literal notranslate"><span class="pre">4.446,</span> <span class="pre">4.924,</span> <span class="pre">...</span></code>.</p>
<p>However, this allows us to see how we can equip our network with custom cost functions. For this, we first get the link travel time coefficients from the <em>Barcelona_net.tntp</em> <a class="reference external" href="https://github.com/bstabler/TransportationNetworks/tree/master/Barcelona">[download from here]</a> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://github.com/bstabler/TransportationNetworks/blob/master/_scripts/parsing%20networks%20in%20Python.ipynb</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/Barcelona_net.tntp&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>   
<span class="n">net</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Get cost coefficients as dict (str -&gt; np.ndarray)</span>
<span class="n">coeffs</span> <span class="o">=</span> <span class="n">net</span><span class="p">[[</span><span class="s2">&quot;free_flow_time&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">]]</span>
<span class="n">coeffs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fft&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]</span>
<span class="n">coeffs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-up-network-cost">
<h2>2. Setting up network cost<a class="headerlink" href="#setting-up-network-cost" title="Permalink to this headline">¶</a></h2>
<p>Second, we set up SymbolicCost, defining the edge cost <span class="math notranslate nohighlight">\(F_e\)</span> and thus the objective function to calculate both user equilibrium (UE) and system optimum (SO).
We find minimum cost flows for user equilibrium and system optimum if we transform the edge cost by:
\begin{align}
\text{User equilibrium:} \quad F_e &amp;= \int_0^{x_e} l_e(s) ds \
\text{System optimum:} \quad F_e &amp;= x_e \cdot l_e \
\end{align}</p>
<p>Note that <a class="reference external" href="https://en.wikipedia.org/wiki/Frank%E2%80%93Wolfe_algorithm">Frank-Wolfe</a> requires the first derivative of the objective function.
Thus, we have to specfiy edge cost <span class="math notranslate nohighlight">\(F_e\)</span> and marginal edge cost <span class="math notranslate nohighlight">\(f_e\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># User equilibrium cost funcs (egde cost and marginal edge cost)</span>
<span class="n">ue_F</span> <span class="o">=</span> <span class="s2">&quot;fft * (x + b * x / (p + 1) * (x / c)**p)&quot;</span>
<span class="n">ue_f</span> <span class="o">=</span> <span class="s2">&quot;fft * (1 + b * (x / c)**p)&quot;</span>
<span class="n">ue_cost</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">SymbolicCost</span><span class="p">(</span>
    <span class="n">coeffs</span><span class="p">,</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">ue_F</span><span class="p">,</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">ue_f</span><span class="p">,</span>
    <span class="n">shared</span><span class="o">=</span><span class="n">barcelona</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># System optimum cost funcs (egde cost and marginal edge cost)</span>
<span class="n">so_F</span> <span class="o">=</span> <span class="s2">&quot;x * fft * (1 + b * x**p * c**(-p))&quot;</span>
<span class="n">so_f</span> <span class="o">=</span> <span class="s2">&quot;fft + fft * b * (p + 1) * c**(-p) * x**(p)&quot;</span>
<span class="n">so_cost</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">SymbolicCost</span><span class="p">(</span>
    <span class="n">coeffs</span><span class="p">,</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">so_F</span><span class="p">,</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">so_f</span><span class="p">,</span>
    <span class="n">shared</span><span class="o">=</span><span class="n">barcelona</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-ue-and-so-flow">
<h2>3. Find UE and SO flow<a class="headerlink" href="#find-ue-and-so-flow" title="Permalink to this headline">¶</a></h2>
<p>Finally, we equip our network with each cost instances and run Frank-Wolfe to find a minimum cost flow:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barcelona</span><span class="o">.</span><span class="n">set_cost</span><span class="p">(</span><span class="n">so_cost</span><span class="p">)</span>
<span class="n">fw_so</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">NetworkFW</span><span class="p">(</span><span class="n">barcelona</span><span class="p">)</span>
<span class="n">fw_so</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">print</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fw_so</span><span class="o">.</span><span class="n">cost</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1285164.7080005545
</pre></div>
</div>
</div>
</div>
<p>For example, we can easily access the user equilibrium flow by:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">so_cost</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">cost2</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">SymbolicCost</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


<span class="n">barcelona</span><span class="o">.</span><span class="n">set_cost</span><span class="p">(</span><span class="n">so_cost</span><span class="p">)</span>
<span class="n">fw_so</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">NetworkFW</span><span class="p">(</span><span class="n">barcelona</span><span class="p">)</span>
<span class="n">fw_so</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">print</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fw_so</span><span class="o">.</span><span class="n">cost</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.npz&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">barcelona</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">cost2</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">SymbolicCost</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;cost_type&#39;,
 &#39;coeffs_fft&#39;,
 &#39;coeffs_b&#39;,
 &#39;coeffs_p&#39;,
 &#39;coeffs_c&#39;,
 &#39;costfuncs_F&#39;,
 &#39;costfuncs_f&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cost_type
coeffs_fft
coeffs_b
coeffs_p
coeffs_c
costfuncs_F
costfuncs_f
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost2</span> <span class="o">=</span> <span class="n">paminco</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">SymbolicCost</span><span class="o">.</span><span class="n">from_npz</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barcelona</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">a817b66495f0</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">barcelona</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">save_to_numpy</span><span class="p">()</span>

<span class="ne">TypeError</span>: save_to_numpy() missing 1 required positional argument: &#39;file&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="price-of-anarchy">
<h2>4. Price of Anarchy<a class="headerlink" href="#price-of-anarchy" title="Permalink to this headline">¶</a></h2>
<p>The objective function to calculate the system optimum is the total system travel time (TSTT):
\begin{equation*}
\text{TSTT}(\mathbf{x}) = \sum_{e \in E} x_{e} \cdot l_{e}(x_e)
\end{equation*}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">TTST</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">so_cost</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We find that the total system travel time for Barcelona is increased by about <code class="docutils literal notranslate"><span class="pre">2.3</span> <span class="pre">percent</span></code> if users behave selfishly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poa</span> <span class="o">=</span> <span class="n">TTST</span><span class="p">(</span><span class="n">fw_ue</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span> <span class="o">/</span> <span class="n">TTST</span><span class="p">(</span><span class="n">fw_so</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
<span class="n">poa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0211888925812171
</pre></div>
</div>
</div>
</div>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Philipp Warode, Per Joachims.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>